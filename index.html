<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Weather Embed</title>
  <link rel="stylesheet" href="weather.css" />
</head>
<body>

  <div class="weather-card" id="weather">
    <div class="weather-loading">Loading weather…</div>
  </div>

  <script>

const apiUrlCurr =
'https://api.weather.gov/stations/KSBP/observations/latest';

const apiUrlFuture =
'https://api.weather.gov/gridpoints/LOX/78,115/forecast';

const headers = {
  "User-Agent":
  "weather-embed-demo (yourname@example.com)"
};


function cToF(c) {
  return Math.round((c * 9) / 5 + 32);
}


async function loadWeather(){

try{

// fetch forecast + current at same time (faster)
const [futureResp, currResp] =
await Promise.all([

fetch(apiUrlFuture,{headers}),
fetch(apiUrlCurr,{headers})

]);

const forecastDataFuture =
await futureResp.json();

const forecastDataCurr =
await currResp.json();


const curr =
forecastDataCurr.properties;

const today =
forecastDataFuture.properties.periods[0];

const tonight =
forecastDataFuture.properties.periods[1];


// ---- HIGH / LOW ----

let high = today.temperature;
let low = tonight.temperature;

if(!today.isDaytime &&
forecastDataFuture.properties.periods[1]){

high =
forecastDataFuture.properties.periods[1].temperature;

low = today.temperature;

}


// ---- CURRENT TEMP ----

const currTempF =
curr.temperature.value !== null
? cToF(curr.temperature.value)
: "--";

renderWeather(
curr,
today,
tonight,
currTempF,
high,
low
);

}catch(err){

document.getElementById("weather").innerHTML =
"<div class='weather-loading'>Weather unavailable</div>";

console.error(err);

}

}



function renderWeather(
curr,
today,
tonight,
currTempF,
high,
low
){

const html = `

<div class="weather-row">

  <!-- TODAY -->

  <div class="section">

    <img
      class="icon"
      src="${curr.icon || today.icon}"
      alt="${today.shortForecast}"
    >

    <div>

      <div class="label">
        ${today.name}
      </div>

      <div class="temp">
        ${currTempF}°F
      </div>

      <div class="desc">
        ${today.shortForecast}
      </div>

      <div class="desc">
        H ${high}°F · L ${low}°F
      </div>

    </div>

  </div>


  <div class="divider"></div>


  <!-- TONIGHT -->

  <div class="section">

    <img
      class="icon"
      src="${tonight.icon}"
      alt="${tonight.shortForecast}"
    >

    <div>

      <div class="label">
        ${tonight.name}
      </div>

      <div class="temp">
        ${tonight.temperature}°F
      </div>

      <div class="desc">
        ${tonight.shortForecast}
      </div>

    </div>

  </div>

</div>


<div class="weather-credit">
Data by weather.gov
</div>

`;

document.getElementById("weather").innerHTML =
html;

}


loadWeather();

</script>

</body>
</html>
