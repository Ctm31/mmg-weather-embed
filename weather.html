<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Weather Embed</title>
  <link rel="stylesheet" href="weather.css" />
</head>
<body>

  <div class="weather-card" id="weather">
    <div class="weather-loading">Loading weather…</div>
  </div>

  <script>
    const apiUrlCurr = 'https://api.weather.gov/stations/KSBP/observations/latest';
    const apiUrlFuture = 'https://api.weather.gov/gridpoints/LOX/78,115/forecast';

    const headers = {
      "User-Agent": "weather-embed-demo (yourname@example.com)"
    };

    function cToF(c) {
      return Math.round((c * 9) / 5 + 32);
    }

    async function loadWeather() {
      try {
        const forecastRespFuture = await fetch(apiUrlFuture, { headers });
        const forecastDataFuture = await forecastRespFuture.json();

        const forecastRespCurr = await fetch(apiUrlCurr, { headers });
        const forecastDataCurr = await forecastRespCurr.json();

        const curr = forecastDataCurr.properties;
        const today = forecastDataFuture.properties.periods[0];
        const tonight = forecastDataFuture.properties.periods[1];

        // High / Low logic
        let high = today.temperature;
        let low = tonight.temperature;

        if (!today.isDaytime && forecastDataFuture.properties.periods[1]) {
          high = forecastDataFuture.properties.periods[1].temperature;
          low = today.temperature;
        }

        // Convert current temp to Fahrenheit
        const currTempF = curr.temperature.value !== null
          ? cToF(curr.temperature.value)
          : "--";

        renderWeather(curr, today, tonight, currTempF, high, low);

      } catch (err) {
        document.getElementById("weather").innerHTML =
          "<div class='weather-loading'>Weather unavailable</div>";
        console.error(err);
      }
    }

    function renderWeather(curr, today, tonight, currTempF, high, low) {
      const html = `
        <div class="today">
          <div class="today-label">${today.name}</div>

          <div class="today-main">
            <img class="weather-icon" src="${curr.icon}" alt="${today.shortForecast}">
            <div class="today-temp">${currTempF}°F</div>
          </div>

          <div class="today-desc">${today.shortForecast}</div>

          <div class="today-hilo">
            H: ${high}°F &nbsp; L: ${low}°F
          </div>
        </div>

        <div class="tonight">
          <div class="tonight-left">
            <img class="tonight-icon" src="${tonight.icon}" alt="${tonight.shortForecast}">
            <div>
              <div class="tonight-label">${tonight.name}</div>
              <div class="tonight-desc">${tonight.shortForecast}</div>
            </div>
          </div>

          <div class="tonight-temp">${tonight.temperature}°F</div>
        </div>

        <div class="weather-credit">Data by weather.gov</div>
      `;

      document.getElementById("weather").innerHTML = html;
    }

    loadWeather();
  </script>

</body>
</html>
